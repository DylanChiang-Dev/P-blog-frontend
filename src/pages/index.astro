---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import ArticleCard from "../components/ArticleCard.astro";
import { api } from "../lib/api";
import type { Article } from "../types";

let articles: Article[] = [];
let error = null;

try {
  const response = await api.get(
    "/api/blog/articles?status=published&limit=100",
  );
  if (response.data.success) {
    articles = response.data.data.items;
  }
} catch (e) {
  console.warn("Backend unavailable", e);
  error = "暫時無法獲取文章，請稍後再試。";
}

// const featuredArticle = articles[0];
// const remainingArticles = articles.slice(1);
---

<Layout title="我的部落格">
  {
    error ? (
      <div class="text-center py-12 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-100 dark:border-red-900/20 mx-4 mt-8">
        {error}
      </div>
    ) : (
      <div class="max-w-7xl mx-auto px-4 py-12">
        {/* Header */}
        <div class="mb-12 pl-4 border-l-4 border-zinc-900 dark:border-white">
          <h1 class="text-3xl font-bold text-zinc-900 dark:text-white mb-2">
            文章列表
          </h1>
          <p class="text-zinc-500 dark:text-zinc-400">記錄思考與技術的軌跡</p>
        </div>

        {/* WeChat Style List Layout */}
        <div class="space-y-8 max-w-2xl mx-auto">
          {articles.map((article) => (
            <ArticleCard article={article} />
          ))}
        </div>
      </div>
    )
  }
</Layout>
